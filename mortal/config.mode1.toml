[control]
version = 4
online = false
decision_head = 'value'
policy_temp = 1.0
policy_top_p = 1.0
policy_epsilon = 0.0

state_file = 'E:/Mahjong/output/checkpoints/mortal_mode1.pth'
best_state_file = 'E:/Mahjong/output/checkpoints/mortal_mode1_best.pth'
tensorboard_dir = 'E:/Mahjong/output/tensorboard/mortal_mode1'

device = 'cuda:0'
enable_cudnn_benchmark = true
enable_amp = true
enable_compile = false

batch_size = 256
opt_step_every = 2

save_every = 400
test_every = 20000
submit_every = 400

[train_play.default]
games = 800
log_dir = 'E:/Mahjong/output/train_play_mode1'
boltzmann_epsilon = 0.005
boltzmann_temp = 0.05
top_p = 1.0
decision_head = 'value'
policy_temp = 1.0
policy_top_p = 1.0
policy_epsilon = 0.0
repeats = 1

[test_play]
games = 800
log_dir = 'E:/Mahjong/output/test_play_mode1'

[dataset]
globs = ['E:/Mahjong/output/mode1/mjai_rust/*.json.gz']
file_index = 'E:/Mahjong/output/mode1/file_index_mode1.pth'
file_batch_size = 12
reserve_ratio = 0.1
num_workers = 4
player_names_files = []
num_epochs = 1
enable_augmentation = true
augmented_first = true

[env]
gamma = 1
pts = [6.0, 4.0, 2.0, 0.0]

[resnet]
conv_channels = 128
num_blocks = 20

[cql]
min_q_weight = 3

[aux]
next_rank_weight = 0.2

[freeze_bn]
mortal = false

[optim]
eps = 1e-8
betas = [0.9, 0.999]
weight_decay = 0.1
max_grad_norm = 1.0

[optim.scheduler]
peak = 2e-4
final = 2e-5
warm_up_steps = 2000
max_steps = 200000

[baseline.train]
device = 'cuda:0'
enable_compile = false
state_file = 'E:/Mahjong/output/checkpoints/baseline_mode1.pth'

[baseline.test]
device = 'cuda:0'
enable_compile = false
state_file = 'E:/Mahjong/output/checkpoints/baseline_mode1.pth'

[online]
history_window = 50
enable_compile = false

[online.remote]
host = '127.0.0.1'
port = 5000

[online.server]
buffer_dir = 'E:/Mahjong/output/online_buffer'
drain_dir = 'E:/Mahjong/output/online_drain'
sample_reuse_rate = 0
sample_reuse_threshold = 0
capacity = 1600
force_sequential = false

[online_policy]
enabled = false
method = 'awac'
freeze_mortal = true
freeze_dqn = true
train_aux = false
actor_lr = 3e-6
actor_weight = 1.0
awac_lambda = 1.0
awac_max_weight = 20.0
entropy_coef = 0.002
bc_coef = 0.05
bc_warmup_steps = 5000

[1v3]
seed_key = -1
games_per_iter = 2000
iters = 500
log_dir = 'E:/Mahjong/output/1v3_mode1'

[1v3.challenger]
device = 'cuda:0'
name = 'mortal'
state_file = 'E:/Mahjong/output/checkpoints/mortal_mode1.pth'
stochastic_latent = false
enable_compile = false
enable_amp = true
enable_rule_based_agari_guard = true

[1v3.champion]
device = 'cuda:0'
name = 'baseline'
state_file = 'E:/Mahjong/output/checkpoints/baseline_mode1.pth'
stochastic_latent = false
enable_compile = false
enable_amp = true
enable_rule_based_agari_guard = true

[1v3.akochan]
enabled = false
dir = '/path/to/akochan'
tactics = '/path/to/tactics.json'

[grp]
state_file = 'E:/Mahjong/output/checkpoints/grp_mode1.pth'

[grp.network]
hidden_size = 64
num_layers = 2

[grp.control]
device = 'cuda:0'
enable_cudnn_benchmark = true
tensorboard_dir = 'E:/Mahjong/output/tensorboard/grp_mode1'
batch_size = 512
save_every = 2000
val_steps = 400

[grp.dataset]
train_globs = ['E:/Mahjong/output/mode1/mjai_rust/*.json.gz']
val_globs = ['E:/Mahjong/output/mode1/mjai_rust/*.json.gz']
file_index = 'E:/Mahjong/output/mode1/grp_file_index_mode1.pth'
file_batch_size = 50

[grp.optim]
lr = 1e-5

